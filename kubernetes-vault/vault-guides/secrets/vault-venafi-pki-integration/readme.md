# Vault Integration Patterns with Venafi
This guide, along with its corresponding blog details the integration between Vault and Venafi using the vault-pki-monitor-venafi plugin

## Reference Material
This code corresponds to a blog published on medium - Vault Integration Patterns with Venafi https://medium.com/@jgerson/vault-integration-patterns-with-venafi-21c3626cdcdb?source=friends_link&sk=4f5b72a9e4b19093792d8753568f3635

## Estimated Time to Complete
This guide should take 30 minutes. 

## Prerequisites
Venafi Trust Protection Platform
HashiCorp Vault

This guide will offer a script for running Vault locally for testing. When deploying to production it is recommended to follow HashiCorp’s deployment guide https://learn.hashicorp.com/vault/operations/ops-deployment-guide. Optionally, an existing Vault development environment may be used.

## Synopsis

The integration options for Vault and Venafi appear in the form of Vault plugins, vault-pki-backend-venafi and vault-pki-monitor-venafi.

The pki-backend is a plugin for Vault which allows certificate requests to be fulfilled directly by Venafi on behalf of 40+ CA's. In this model Vault provides the common API for devops teams to perform certificate requests, while the Venafi platform fulfills the request. Since each request for a certificate is fulfilled by Venafi, latency between the platforms should be considered.

The pki-monitor is another plugin for Vault which allows Vault issued certificates to be governed by Venafi policy and auditing capabilities. The plugin can monitor Vault issued certificates when Vault operates as an intermediate or root CA. 

For this discussion, Vault will function as an intermediate CA from an internal root Microsoft CA. If you are familiar with the native pki engine in Vault, the workflow to setup and operate the pki-monitor plugin is similar. The added benefit with this approach is that policy is centrally defined in Venafi, downloaded to Vault during plugin setup and enforced during the certificate generation request to Vault without the added latency of Venafi fulfilling the request. Auditability is maintained via Venafi on any certificate generated by Vault.

Please note there are some pre-requisite Venafi setups explained in the blog post prior to 5_init_subca.sh

## Scripts 
Scripts were validated on ubuntu 16.04 and may require adjustments if running on other platforms. 

### Step 1: 1_prepare_plugin.sh - Download and Prepare Plugin
### Step 2: 2_start_over.sh - Kill any running Vault and start Vault (optional)
### Step 3: 3_init_vault.sh - Initialize Vault (optional)
### Step 4: 4_install plugin.sh - Add Plugin to Vault
### Step 5: 5_init_subca.sh - Initialize Vault as a subca
### Step 6: 6_test_subca.sh - Test subca

